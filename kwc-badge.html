<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../iron-image/iron-image.html">
<link rel="import" href="../paper-tooltip/paper-tooltip.html">
<link rel="import" href="../web-components/kano-style/kano-style.html">

<!--
`kwc-badge`
A small atomic badge display for Kano badges.

Custom property | Description | Default
----------------|-------------|----------
`--kwc-badge-size` | The width and height of the badge | `100px`

@group Kano Web Components
@demo demo/index.html
-->

<dom-module id="kwc-badge">
    <template>
        <style>
            :host {
                --paper-tooltip-background: var(--color-abbey);
                --paper-tooltip-opacity: 1;
                --paper-tooltip-text-color: var(--color-white);
                --paper-tooltip: {
                    border-radius: 3px;
                    font-family: var(--font-body);
                    line-height: 24px;
                    padding: 16px 24px;
                    width: 200px;
                };
                @apply --layout-vertical;
                @apply --layout-wrap;
                @apply --layout-center-justified;
            }
            :host iron-image {
                height: var(--kwc-badge-size, 100px);
                width: var(--kwc-badge-size, 100px);
                -webkit-filter: grayscale(100%);
                filter: grayscale(100%);
            }
            :host([unlocked]) iron-image {
                -webkit-filter: grayscale(0%);
                filter: grayscale(0%);
            }
            :host .triangle {
                border-left: 16px solid transparent;
                border-right: 16px solid transparent;
                border-bottom: 16px solid var(--color-abbey);
                height: 0;
                left: 0;
                margin: auto;
                position: absolute;
                right: 0;
                top: -8px;
                width: 0;
            }
            :host paper-tooltip h3 {
                font-size: 18px;
                margin: 0px 0px 10px 0px;
            }
            :host paper-tooltip p {
                font-size: 16px;
                margin: 0px 0px 5px 0px;
            }
            :host *[hidden] {
                display: none;
            }

            /*
            XXX: Hide fullscreen button on mobile screens while the
            functionality until a full responsive solution is in place.
            `768px` is the current media query value for `kwc-masthead`.
            */
            @media (max-width: 768px) {
                paper-tooltip {
                    display: none;
                }
            }
        </style>
        <iron-image id="badge"
                    alt="[[title]]"
                    sizing="contain"
                    src="[[imageUrl]]">
                    </iron-image>
        <template is="dom-if" if="[[tooltip]]">
            <paper-tooltip for="badge"
                           animation-delay="0"
                           margin-top="20"
                           position="bottom"
                           fit-to-visible-bounds>
                <div class="triangle"></div>
                <h3>[[title]]</h3>
                <p hidden$="[[_displayDescription]]">[[criteria]]</p>
                <p hidden$="[[!_displayDescription]]">[[description]]</p>
            </paper-tooltip>
        </template>
    </template>

    <script>
        Polymer({
            is: 'kwc-badge',
            properties: {
                /** The criteria that users much meet to unlock the badge */
                criteria: {
                    type: String
                },
                /**
                 * Boolean to indicate whether the user viewing the badge
                 * is the one that has earned the badge
                 */
                currentUser: {
                    type: Boolean,
                    value: false
                },
                /** The badge description to show to the current user */
                description: {
                    type: String
                },
                /**
                 * Boolean to indicate whether the desription or the criteria
                 * should be shown. The criteria should be shown if the badge is
                 * locked, or if the user that has earned the badge and the
                 * user currently viewing the badge are different. If the badge
                 * has been earned by the current user, then the description
                 * should be shown.
                 */
                _displayDescription: {
                    type: Boolean,
                    computed: '_unlockedByUser(currentUser, unlocked)'
                },
                /** The URL of the badge image */
                imageUrl: {
                    type: String
                },
                /** The title of the badge */
                title: {
                    type: String
                },
                /**
                 * Boolean to indicate whether the tooltip should
                 * be shown on mouseover
                 */
                tooltip: {
                    type: Boolean,
                    value: true
                },
                /**
                 * Boolean to indicate whether the user has
                 * unlocked the badge
                 */
                unlocked: {
                    type: Boolean,
                    value: false,
                    reflectToAttribute: true
                }
            },
            _unlockedByUser (currentUser, unlocked) {
                return currentUser && unlocked;
            }
        });
    </script>
</dom-module>
